{
  "permissions": {
    "allow": [
      "Bash(bash test-chaos.sh:*)",
      "Bash(kubectl cluster-info:*)",
      "Bash(kubectl config:*)",
      "Bash(docker build:*)",
      "Bash(minikube image load:*)",
      "Bash(kubectl apply:*)",
      "Bash(kubectl wait:*)",
      "Bash(kubectl get:*)",
      "Bash(kubectl top:*)",
      "Bash(kubectl delete:*)",
      "Bash(kubectl describe:*)",
      "Bash(for i in {1..5})",
      "Bash(do echo \"=== Test $i ===\")",
      "Bash(curl:*)",
      "Bash(done)",
      "Bash(for:*)",
      "Bash(do echo \"Test $i:\")",
      "Bash(minikube service:*)",
      "Bash(kubectl patch:*)",
      "Bash(echo:*)",
      "Bash(kubectl logs:*)",
      "Bash(cat:*)",
      "Bash(/tmp/quick-start-http-chaos.sh <<'SCRIPT'\n#!/bin/bash\n# Quick Start: HTTP Request/Response Replacement\n\necho \"===================================\"\necho \"HTTP Chaos - Quick Start Guide\"\necho \"===================================\"\necho \"\"\n\n# Example 1: Replace Response Body\necho \"Creating: Response Body Replacement Experiment...\"\nkubectl apply -f - <<'EOF'\napiVersion: chaos-mesh.org/v1alpha1\nkind: HTTPChaos\nmetadata:\n  name: demo-response-replace\n  namespace: chaos-demo\nspec:\n  mode: all\n  selector:\n    namespaces:\n      - chaos-demo\n    labelSelectors:\n      app: backend\n  target: Response\n  port: 5001\n  path: \"/data\"\n  method: GET\n  replace:\n    body: eyJjaGFvcyI6IlJlc3BvbnNlIFJlcGxhY2VkISIsImRhdGEiOiJIQUNLRUQifQ==\n  duration: \"5m\"\nEOF\n\necho \"\"\necho \"âœ… Experiment created!\"\necho \"\"\necho \"Test it:\"\necho \"  curl http://localhost:5000/api/data | jq .\"\necho \"\"\necho \"View in dashboard:\"\necho \"  http://localhost:2333\"\necho \"\"\necho \"Cleanup when done:\"\necho \"  kubectl delete httpchaos demo-response-replace -n chaos-demo\"\nSCRIPT)",
      "Bash(__NEW_LINE__ chmod +x /tmp/quick-start-http-chaos.sh)",
      "Bash(/tmp/CHAOS-INJECTION-GUIDE.md <<'EOF'\n# Chaos Mesh - Complete Injection & Testing Guide\n\n## ğŸ¯ Quick Reference\n\n### Check What's Running\n```bash\n# View all chaos experiments\nkubectl get networkchaos,podchaos,httpchaos,stresschaos,iochaos,workflows -n chaos-demo\n\n# Check pod status\nkubectl get pods -n chaos-demo\n\n# View application logs\nkubectl logs -n chaos-demo -l app=frontend --tail=20\nkubectl logs -n chaos-demo -l app=backend --tail=20\n```\n\n### Dashboard Access\n```bash\n# Already running at:\nhttp://localhost:2333\n\n# Or open with minikube:\nminikube service chaos-dashboard -n chaos-mesh\n```\n\n---\n\n## ğŸ“‹ Available Endpoints to Test\n\n### Frontend Service (Port 5000)\n1. **GET /health** - Health check\n2. **GET /** - Home page with endpoint list\n3. **GET /api/data** - Calls backend, returns data\n4. **POST /api/process** - Process JSON data via backend\n5. **GET /api/slow** - Configurable delay endpoint\n6. **GET /api/chain** - Makes 3 backend calls (test partial failures)\n\n### Backend Service (Port 5001)\n1. **GET /health** - Health check\n2. **GET /data** - Returns JSON data\n3. **POST /process** - Processes POST data\n4. **GET /echo** - Echoes request details\n\n---\n\n## ğŸ§ª Testing Scenarios\n\n### SCENARIO 1: Network Delay Chaos\n\n#### Step 1: Test WITHOUT Chaos (Baseline)\n```bash\n# Test latency (should be < 50ms)\ntime curl -s http://localhost:5000/api/data | jq '.latency_ms'\n\n# Multiple requests to see average\nfor i in {1..5}; do\n  echo \"Request $i:\"\n  curl -s -w \"Total time: %{time_total}s\\n\" http://localhost:5000/api/data | jq -c '{latency_ms}'\ndone\n```\n\n**Expected Output:**\n```\nRequest 1: {\"latency_ms\":5.23}\nTotal time: 0.015s\nRequest 2: {\"latency_ms\":3.45}\nTotal time: 0.012s\n```\n\n#### Step 2: Apply Network Delay Chaos\n```bash\nkubectl apply -f - <<'CHAOS'\napiVersion: chaos-mesh.org/v1alpha1\nkind: NetworkChaos\nmetadata:\n  name: network-delay-test\n  namespace: chaos-demo\nspec:\n  action: delay\n  mode: all\n  selector:\n    namespaces:\n      - chaos-demo\n    labelSelectors:\n      app: frontend\n  delay:\n    latency: \"1000ms\"    # 1 second delay\n    jitter: \"200ms\"      # Â±200ms variation\n  direction: to\n  target:\n    selector:\n      namespaces:\n        - chaos-demo\n      labelSelectors:\n        app: backend\n    mode: all\n  duration: \"3m\"\nCHAOS\n```\n\n#### Step 3: Test WITH Chaos\n```bash\n# Wait 5 seconds for chaos to take effect\nsleep 5\n\n# Test again (should show ~1000ms+ delay)\nfor i in {1..5}; do\n  echo \"Request $i:\"\n  curl -s -w \"Total time: %{time_total}s\\n\" http://localhost:5000/api/data | jq -c '{latency_ms}'\ndone\n```\n\n**Expected Output:**\n```\nRequest 1: {\"latency_ms\":1056.23}\nTotal time: 1.065s\nRequest 2: {\"latency_ms\":987.45}\nTotal time: 0.998s\n```\n\n#### Step 4: Cleanup\n```bash\nkubectl delete networkchaos network-delay-test -n chaos-demo\n```\n\n---\n\n### SCENARIO 2: HTTP Response Replacement\n\n#### Step 1: Normal Response\n```bash\ncurl -s http://localhost:5000/api/data | jq '.backend_response.data'\n```\n\n**Expected Output:**\n```json\n{\n  \"items\": [\n    {\"id\": 1, \"name\": \"Item A\", \"value\": 42},\n    {\"id\": 2, \"name\": \"Item B\", \"value\": 99},\n    {\"id\": 3, \"name\": \"Item C\", \"value\": 55}\n  ],\n  \"total\": 3\n}\n```\n\n#### Step 2: Inject HTTP Chaos\n```bash\n# Encode your malicious response\necho -n '{\"status\":\"HACKED\",\"message\":\"All your data are belong to us\"}' | base64\n# Output: eyJzdGF0dXMiOiJIQUNLRUQiLCJtZXNzYWdlIjoiQWxsIHlvdXIgZGF0YSBhcmUgYmVsb25nIHRvIHVzIn0=\n\nkubectl apply -f - <<'CHAOS'\napiVersion: chaos-mesh.org/v1alpha1\nkind: HTTPChaos\nmetadata:\n  name: response-hack\n  namespace: chaos-demo\nspec:\n  mode: all\n  selector:\n    namespaces:\n      - chaos-demo\n    labelSelectors:\n      app: backend\n  target: Response\n  port: 5001\n  path: \"/data\"\n  method: GET\n  replace:\n    body: eyJzdGF0dXMiOiJIQUNLRUQiLCJtZXNzYWdlIjoiQWxsIHlvdXIgZGF0YSBhcmUgYmVsb25nIHRvIHVzIn0=\n  duration: \"3m\"\nCHAOS\n```\n\n#### Step 3: Test Replaced Response\n```bash\nsleep 3\ncurl -s http://localhost:5000/api/data | jq '.backend_response'\n```\n\n**Expected Output:**\n```json\n{\n  \"status\": \"HACKED\",\n  \"message\": \"All your data are belong to us\"\n}\n```\n\n#### Step 4: Cleanup\n```bash\nkubectl delete httpchaos response-hack -n chaos-demo\n```\n\n---\n\n### SCENARIO 3: Pod Kill (Test Auto-Recovery)\n\n#### Step 1: Check Current Pods\n```bash\nkubectl get pods -n chaos-demo -o wide\n```\n\n#### Step 2: Monitor Pods in Real-Time\n```bash\n# In a separate terminal, watch pods:\nwatch -n 1 'kubectl get pods -n chaos-demo'\n```\n\n#### Step 3: Apply Pod Kill Chaos\n```bash\nkubectl apply -f - <<'CHAOS'\napiVersion: chaos-mesh.org/v1alpha1\nkind: PodChaos\nmetadata:\n  name: pod-kill-test\n  namespace: chaos-demo\nspec:\n  action: pod-kill\n  mode: one          # Kill one random pod\n  selector:\n    namespaces:\n      - chaos-demo\n    labelSelectors:\n      app: backend\nCHAOS\n```\n\n#### Step 4: Test During Recovery\n```bash\n# Make requests while pod is recovering\nfor i in {1..10}; do\n  echo \"Request $i at $(date +%H:%M:%S):\"\n  curl -s -w \"Status: %{http_code}\\n\" http://localhost:5000/api/data -o /dev/null\n  sleep 2\ndone\n```\n\n**Expected Behavior:**\n- Pod gets killed immediately\n- Kubernetes starts new pod\n- Some requests may fail (503) during recovery\n- Service auto-recovers within 10-20 seconds\n\n#### Step 5: Cleanup\n```bash\nkubectl delete podchaos pod-kill-test -n chaos-demo\n```\n\n---\n\n### SCENARIO 4: POST Request Replacement\n\n#### Step 1: Normal POST Request\n```bash\ncurl -s -X POST http://localhost:5000/api/process \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"username\":\"alice\",\"action\":\"login\",\"timestamp\":1234567890}' | jq .\n```\n\n**Expected Output:**\n```json\n{\n  \"message\": \"Processed 3 fields\",\n  \"processed\": true,\n  \"received\": {\n    \"username\": \"alice\",\n    \"action\": \"login\",\n    \"timestamp\": 1234567890\n  }\n}\n```\n\n#### Step 2: Inject Request Replacement\n```bash\n# Encode malicious payload\necho -n '{\"sql\":\"DROP TABLE users;\",\"injected\":true}' | base64\n# Output: eyJzcWwiOiJEUk9QIFRBQkxFIHVzZXJzOyIsImluamVjdGVkIjp0cnVlfQ==\n\nkubectl apply -f - <<'CHAOS'\napiVersion: chaos-mesh.org/v1alpha1\nkind: HTTPChaos\nmetadata:\n  name: request-injection\n  namespace: chaos-demo\nspec:\n  mode: all\n  selector:\n    namespaces:\n      - chaos-demo\n    labelSelectors:\n      app: backend\n  target: Request\n  port: 5001\n  path: \"/process\"\n  method: POST\n  replace:\n    body: eyJzcWwiOiJEUk9QIFRBQkxFIHVzZXJzOyIsImluamVjdGVkIjp0cnVlfQ==\n  duration: \"3m\"\nCHAOS\n```\n\n#### Step 3: Test Replaced Request\n```bash\nsleep 3\n\n# Send normal request, but backend receives injected payload!\ncurl -s -X POST http://localhost:5000/api/process \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"username\":\"alice\",\"action\":\"login\"}' | jq .\n```\n\n**Expected Output:**\n```json\n{\n  \"message\": \"Processed 2 fields\",\n  \"processed\": true,\n  \"received\": {\n    \"sql\": \"DROP TABLE users;\",\n    \"injected\": true\n  }\n}\n```\n\n#### Step 4: Cleanup\n```bash\nkubectl delete httpchaos request-injection -n chaos-demo\n```\n\n---\n\n### SCENARIO 5: Packet Loss\n\n#### Step 1: Test Chain Endpoint (Makes 3 Backend Calls)\n```bash\ncurl -s http://localhost:5000/api/chain | jq '.chain_results[] | {call, status, latency_ms}'\n```\n\n**Expected Output:**\n```json\n{\"call\":1,\"status\":\"success\",\"latency_ms\":5.2}\n{\"call\":2,\"status\":\"success\",\"latency_ms\":3.8}\n{\"call\":3,\"status\":\"success\",\"latency_ms\":4.1}\n```\n\n#### Step 2: Apply 50% Packet Loss\n```bash\nkubectl apply -f - <<'CHAOS'\napiVersion: chaos-mesh.org/v1alpha1\nkind: NetworkChaos\nmetadata:\n  name: packet-loss-test\n  namespace: chaos-demo\nspec:\n  action: loss\n  mode: all\n  selector:\n    namespaces:\n      - chaos-demo\n    labelSelectors:\n      app: frontend\n  loss:\n    loss: \"50\"        # 50% packet loss\n    correlation: \"25\" # Burst losses\n  direction: to\n  target:\n    selector:\n      namespaces:\n        - chaos-demo\n      labelSelectors:\n        app: backend\n    mode: all\n  duration: \"3m\"\nCHAOS\n```\n\n#### Step 3: Test With Packet Loss\n```bash\nsleep 5\n\n# Run multiple times to see failures\nfor i in {1..5}; do\n  echo \"=== Test $i ===\"\n  curl -s http://localhost:5000/api/chain | jq '.chain_results[] | {call, status}'\n  echo \"\"\ndone\n```\n\n**Expected Output:**\n```json\n=== Test 1 ===\n{\"call\":1,\"status\":\"success\"}\n{\"call\":2,\"status\":\"error\"}\n{\"call\":3,\"status\":\"success\"}\n\n=== Test 2 ===\n{\"call\":1,\"status\":\"error\"}\n{\"call\":2,\"status\":\"error\"}\n{\"call\":3,\"status\":\"success\"}\n```\n\n#### Step 4: Cleanup\n```bash\nkubectl delete networkchaos packet-loss-test -n chaos-demo\n```\n\n---\n\n### SCENARIO 6: HTTP Error Injection (500 Errors)\n\n#### Step 1: Apply HTTP 500 Error Chaos\n```bash\nkubectl apply -f - <<'CHAOS'\napiVersion: chaos-mesh.org/v1alpha1\nkind: HTTPChaos\nmetadata:\n  name: http-500-errors\n  namespace: chaos-demo\nspec:\n  mode: all\n  selector:\n    namespaces:\n      - chaos-demo\n    labelSelectors:\n      app: backend\n  target: Response\n  port: 5001\n  path: \"/data\"\n  method: GET\n  abort: true\n  statusCode: 500\n  duration: \"3m\"\nCHAOS\n```\n\n#### Step 2: Test Error Responses\n```bash\nsleep 3\n\nfor i in {1..5}; do\n  echo \"Request $i:\"\n  curl -s -w \"HTTP Status: %{http_code}\\n\" http://localhost:5000/api/data | head -1\ndone\n```\n\n**Expected Output:**\n```\nRequest 1:\nHTTP Status: 500\n\nRequest 2:\nHTTP Status: 500\n```\n\n#### Step 3: Cleanup\n```bash\nkubectl delete httpchaos http-500-errors -n chaos-demo\n```\n\n---\n\n### SCENARIO 7: CPU Stress Test\n\n#### Step 1: Check Baseline Resource Usage\n```bash\nkubectl top pods -n chaos-demo\n```\n\n#### Step 2: Apply CPU Stress\n```bash\nkubectl apply -f - <<'CHAOS'\napiVersion: chaos-mesh.org/v1alpha1\nkind: StressChaos\nmetadata:\n  name: cpu-stress-test\n  namespace: chaos-demo\nspec:\n  mode: all\n  selector:\n    namespaces:\n      - chaos-demo\n    labelSelectors:\n      app: backend\n  stressors:\n    cpu:\n      workers: 2      # 2 CPU stress workers\n      load: 80        # 80% CPU load per worker\n  duration: \"3m\"\nCHAOS\n```\n\n#### Step 3: Test Performance During Stress\n```bash\nsleep 5\n\n# Measure response times under load\nfor i in {1..10}; do\n  time curl -s http://localhost:5000/api/data -o /dev/null\ndone\n```\n\n#### Step 4: Monitor Resource Usage\n```bash\nkubectl top pods -n chaos-demo\n```\n\n#### Step 5: Cleanup\n```bash\nkubectl delete stresschaos cpu-stress-test -n chaos-demo\n```\n\n---\n\n## ğŸ”¥ Advanced: Combined Chaos Workflow\n\n### Multi-Step Chaos Test\n```bash\nkubectl apply -f - <<'CHAOS'\napiVersion: chaos-mesh.org/v1alpha1\nkind: Workflow\nmetadata:\n  name: combined-chaos-test\n  namespace: chaos-demo\nspec:\n  entry: serial-entry\n  templates:\n    - name: serial-entry\n      templateType: Serial\n      deadline: \"10m\"\n      children:\n        - delay-step\n        - kill-step\n        - stress-step\n    \n    - name: delay-step\n      templateType: NetworkChaos\n      deadline: \"2m\"\n      networkChaos:\n        action: delay\n        mode: all\n        selector:\n          namespaces:\n            - chaos-demo\n          labelSelectors:\n            app: frontend\n        delay:\n          latency: \"500ms\"\n        direction: to\n        target:\n          selector:\n            namespaces:\n              - chaos-demo\n            labelSelectors:\n              app: backend\n          mode: all\n    \n    - name: kill-step\n      templateType: PodChaos\n      deadline: \"1m\"\n      podChaos:\n        action: pod-kill\n        mode: one\n        selector:\n          namespaces:\n            - chaos-demo\n          labelSelectors:\n            app: backend\n    \n    - name: stress-step\n      templateType: StressChaos\n      deadline: \"2m\"\n      stressChaos:\n        mode: all\n        selector:\n          namespaces:\n            - chaos-demo\n          labelSelectors:\n            app: backend\n        stressors:\n          cpu:\n            workers: 1\n            load: 50\nCHAOS\n```\n\n### Monitor Workflow\n```bash\n# Watch workflow progress\nkubectl get workflow combined-chaos-test -n chaos-demo -w\n\n# Test continuously during workflow\nwhile true; do\n  echo \"$(date +%H:%M:%S) - Status: $(curl -s -o /dev/null -w '%{http_code}' http://localhost:5000/api/data)\"\n  sleep 2\ndone\n```\n\n---\n\n## ğŸ§¹ Cleanup All Chaos\n\n```bash\n# Remove all chaos experiments\nkubectl delete networkchaos --all -n chaos-demo\nkubectl delete podchaos --all -n chaos-demo\nkubectl delete httpchaos --all -n chaos-demo\nkubectl delete stresschaos --all -n chaos-demo\nkubectl delete iochaos --all -n chaos-demo\nkubectl delete workflow --all -n chaos-demo\n\n# Verify clean state\nkubectl get networkchaos,podchaos,httpchaos,stresschaos -n chaos-demo\n```\n\n---\n\n## ğŸ“Š Monitoring & Verification\n\n### Quick Health Check\n```bash\n# Test all endpoints\ncurl -s http://localhost:5000/health && echo \" âœ“ Frontend healthy\"\ncurl -s http://localhost:5000/api/data | jq -c '{status: \"ok\", latency: .latency_ms}' && echo \" âœ“ Backend healthy\"\n```\n\n### Detailed Logs\n```bash\n# Watch frontend logs\nkubectl logs -n chaos-demo -l app=frontend -f\n\n# Watch backend logs\nkubectl logs -n chaos-demo -l app=backend -f\n\n# View chaos events\nkubectl describe networkchaos -n chaos-demo\nkubectl describe httpchaos -n chaos-demo\n```\n\n### Dashboard Metrics\nOpen http://localhost:2333 and navigate to:\n- **Experiments** â†’ See all active chaos\n- **Events** â†’ Real-time chaos events\n- **Archives** â†’ Historical experiment data\n\n---\n\n## ğŸ’¡ Tips & Best Practices\n\n1. **Always test baseline first** - Know normal behavior before chaos\n2. **Start small** - Begin with short durations (1-2 minutes)\n3. **Monitor pods** - Use `watch kubectl get pods -n chaos-demo`\n4. **Check logs** - Look for errors during chaos: `kubectl logs -n chaos-demo -l app=backend --tail=50`\n5. **Clean up** - Remove experiments after testing\n6. **Use dashboard** - Visual feedback is easier than CLI\n\n---\n\n## ğŸ†˜ Troubleshooting\n\n### Chaos not taking effect?\n```bash\n# Check if pods have chaos-mesh sidecar\nkubectl get pods -n chaos-demo -o jsonpath='{range .items[*]}{.metadata.name}{\"\\t\"}{.metadata.annotations.chaos-mesh\\.org/inject}{\"\\n\"}{end}'\n\n# Should show \"true\" for sidecar injection\n```\n\n### Port forward not working?\n```bash\n# Kill existing port-forwards\npkill -f \"port-forward\"\n\n# Restart\nkubectl port-forward -n chaos-demo svc/frontend-service 5000:5000 &\nkubectl port-forward -n chaos-mesh svc/chaos-dashboard 2333:2333 &\n```\n\n### Experiments stuck?\n```bash\n# Force delete\nkubectl delete httpchaos <name> -n chaos-demo --force --grace-period=0\n```\n\n---\n\n## ğŸ“š Reference\n\n- Chaos Mesh Docs: https://chaos-mesh.org/docs/\n- API Reference: https://chaos-mesh.org/docs/simulate-http-chaos-on-kubernetes/\n- Dashboard: http://localhost:2333\n- Application: http://localhost:5000\nEOF)",
      "Bash(__NEW_LINE__ cat /tmp/CHAOS-INJECTION-GUIDE.md)",
      "Bash(/tmp/test-chaos-scenarios.sh <<'SCRIPT'\n#!/bin/bash\n# Quick Chaos Testing Script with curl commands\n\necho \"â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\"\necho \"â•‘     CHAOS MESH - QUICK TEST SCENARIOS                â•‘\"\necho \"â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"\necho \"\"\n\n# Test 1: Baseline\necho \"â”â”â” TEST 1: BASELINE (No Chaos) â”â”â”\"\necho \"Command: curl -s http://localhost:5000/api/data | jq -c '{latency_ms}'\"\necho \"Result:\"\ncurl -s http://localhost:5000/api/data | jq -c '{latency_ms: .latency_ms, data_count: .backend_response.data.total}'\necho \"\"\n\n# Clean up any existing chaos\nkubectl delete httpchaos --all -n chaos-demo 2>/dev/null || true\n\nsleep 3\n\n# Test 2: HTTP Response Replacement\necho \"â”â”â” TEST 2: HTTP RESPONSE REPLACEMENT â”â”â”\"\necho \"Injecting chaos: Replacing backend response with HACKED data...\"\n\necho -n '{\"HACKED\":true,\"message\":\"Your data has been compromised!\"}' | base64 > /tmp/hack.b64\n\nkubectl apply -f - <<EOF >/dev/null\napiVersion: chaos-mesh.org/v1alpha1\nkind: HTTPChaos\nmetadata:\n  name: demo-hack\n  namespace: chaos-demo\nspec:\n  mode: all\n  selector:\n    namespaces:\n      - chaos-demo\n    labelSelectors:\n      app: backend\n  target: Response\n  port: 5001\n  path: \"/data\"\n  method: GET\n  replace:\n    body: $(cat /tmp/hack.b64)\n  duration: \"2m\"\nEOF\n\necho \"Waiting 5 seconds for chaos to activate...\"\nsleep 5\n\necho \"\"\necho \"Command: curl -s http://localhost:5000/api/data | jq '.backend_response'\"\necho \"Result:\"\ncurl -s http://localhost:5000/api/data | jq '.backend_response'\necho \"\"\necho \"âœ“ Notice the response is now HACKED!\"\necho \"\"\n\n# Cleanup\nkubectl delete httpchaos demo-hack -n chaos-demo >/dev/null 2>&1\n\nsleep 2\n\n# Test 3: POST Request Injection\necho \"â”â”â” TEST 3: POST REQUEST INJECTION â”â”â”\"\necho \"Injecting SQL injection payload into POST requests...\"\n\necho -n '{\"sql\":\"DROP TABLE users;\",\"hacked\":true}' | base64 > /tmp/inject.b64\n\nkubectl apply -f - <<EOF >/dev/null\napiVersion: chaos-mesh.org/v1alpha1\nkind: HTTPChaos\nmetadata:\n  name: demo-inject\n  namespace: chaos-demo\nspec:\n  mode: all\n  selector:\n    namespaces:\n      - chaos-demo\n    labelSelectors:\n      app: backend\n  target: Request\n  port: 5001\n  path: \"/process\"\n  method: POST\n  replace:\n    body: $(cat /tmp/inject.b64)\n  duration: \"2m\"\nEOF\n\nsleep 5\n\necho \"\"\necho \"Command: curl -X POST http://localhost:5000/api/process -H 'Content-Type: application/json' -d '{\\\"user\\\":\\\"alice\\\"}'\"\necho \"\"\necho \"What we sent: {\\\"user\\\":\\\"alice\\\"}\"\necho \"What backend received:\"\ncurl -s -X POST http://localhost:5000/api/process \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"user\":\"alice\"}' | jq '.received'\necho \"\"\necho \"âœ“ Backend received our INJECTED payload instead!\"\necho \"\"\n\n# Cleanup\nkubectl delete httpchaos demo-inject -n chaos-demo >/dev/null 2>&1\n\necho \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"\necho \"All tests completed! âœ“\"\necho \"\"\necho \"More scenarios available in: /tmp/CHAOS-INJECTION-GUIDE.md\"\necho \"Dashboard: http://localhost:2333\"\nSCRIPT)",
      "Bash(__NEW_LINE__ chmod +x /tmp/test-chaos-scenarios.sh)",
      "Bash(bash:*)",
      "Bash(ls:*)",
      "Bash(kubectl exec:*)",
      "Bash(time curl:*)"
    ],
    "deny": [],
    "ask": []
  }
}
